function Inngangsdata(){function t(){e=!1,Object.keys(i).forEach(function(t){var n=i[t];if(n[1]){e=!0;try{s[n[0]][t]()}catch(r){}}})}var e=!1,i={keydown:{},keyup:{}},s={keydown:{},keyup:{}};this.tastatur={keydown:{},keyup:{}},this.håndtererTrykk=function(t){var n=this.tastatur[t.type][t.keyCode];if(n&&(i[t.keyCode]="keydown"===t.type&&[t.type,!0]||[t.type,!1],e=i[t.keyCode][0],s[t.type][t.keyCode]=n),"keyup"===t.type){i[t.keyCode]=[t.type,!1];try{s[t.type][t.keyCode]()}catch(r){}}},this.hentMusePos=function(t,e){var i={};if(i.x=t.clientX,i.y=t.clientY,e){var s=e.getBoundingClientRect();i.x=(i.x-s.left)/(s.right-s.left)*e.width,i.y=(i.y-s.top)/(s.bottom-s.top)*e.height}return i},this.sjekkOmMusePosErInnenforObjekt=function(t,e){return t.x>e.x&&t.y>e.y&&t.x<e.x+e.bredde&&t.y<e.y+(e.høyde||e.fontSize)},this.klikkbareObjekter=[],this.oppdater=function(){e&&t()},window.addEventListener("keydown",this.håndtererTrykk.bind(this),!1),window.addEventListener("keyup",this.håndtererTrykk.bind(this),!1)}function BildeAtlasObjekt(t,e,i,s,n,r){SkjemObjekt.call(this,i,s,n,r),this.atlas=t,this.bildeNavn=e,this.bildeData=!1,this.lag=[],(0===this.høyde?0!==this.bredde:0===this.bredde)&&this.settBreddeHøyde(),0!==this.bredde&&0!==this.høyde&&this.atlasBildeLag(0,!1,e)}function MønsterObjekt(t,e,i,s){SkjemObjekt.call(this,t,e,i,s),this.mønster=!1}function SkjemObjekt(t,e,i,s){this.x=t,this.y=e,this.bredde=i,this.høyde=s,this.rotasjon=0,this.reflekter={x:!1,y:!1},this.skalar={x:1,y:1},this.roterRundt={x:.5,y:.5}}function Statusbar(t,e,i,s,n){SkjemObjekt.call(this,t,e,i,s),this.farge=n,this.bakgrunnsfarge="black",this.kantlinje={lagd:!1,tykkelse:0,fillStyle:"black"},this.nåværendeProssess=1}function TekstObjekt(t,e,i,s,n){SkjemObjekt.call(this,e,i,0,16),this.tekst=t,this.font=n?n:"Arial",this.textBaseline="top",this.textAlign="start",this.fillStyle=s?s:"black",this.kantlinje={laget:!1}}function VerdensObjekt(t,e,i,s,n,r){BildeAtlasObjekt.call(this,t,e,i-Spill.globalX,s-Spill.globalY,n,r),this.globalX=i,this.globalY=s}function Effekt(t,e,i,s,n){BildeAtlasObjekt.call(this,t.atlas,t.bildeNavn,e,i,s,n),this.type=t,this.skalTegnes=!1,this.varighet=t.varighet}function Enhet(t,e,i,s,n,r){VerdensObjekt.call(this,t,e,i,s,n,r),this.liv=100,this.maxLiv=this.liv,this.død=!1,this.fartX=0,this.nåværendeAkselerasjonX=0,this.fartsgrenseX=4*config.pikselPerMeter,this.retningFartX=1,this.akselerasjonX=config.pikselPerMeter/7.33,this.deakselerasjonX=10*config.pikselPerMeter,this.akselerasjonY=config.pikselPerMeter/22,this.fartY=0}function Fiende(t,e,i,s,n,r,l){Enhet.call(this,t,e,s,n,r,l),this.mål=i,this.erSpawnet=!1,this.poengForDrap=0,this.helsebar=new Statusbar(this.x,this.y,this.bredde,9,"red"),this.helsebar.lagKantLinje(1,"white")}function FiendeBølge(t,e,i,s,n,r){this.mål=t,this.globalX=e,this.globalY=i,this.typer=s,this.fiendeTypeIndeks=n,this.sekundPerFiende=r,this.tidSidenSistFiende=Number.MAX_VALUE/2,this.erTom=!1,this.bølgeFiender=[],this.uSpawnedeFiender=function(){for(var s=[],n=0;n<this.fiendeTypeIndeks.length;n++){var r=this.fiendeTypeIndeks[n];if("number"==typeof r&&r<this.typer.length){var l=new this.typer[r](t,e,i);s.push(l)}}return s}.bind(this)()}function FiendeKompebu(t,e,i){Fiende.call(this,Atlas.typer.TING,"fiendeDagnysKompebu",t,e,i,0,2.5*config.pikselPerMeter),this.fartsgrenseX=2*config.pikselPerMeter,this.våpen=new Våpen(this,t,Våpen.typer.DAGNYSKOMPEBLASTER,0,0,1.4*config.pikselPerMeter,0),this.relativtVåpenAnkerpunkt=[.68,.3],this.akselerasjonX=config.pikselPerMeter/80,this.deakselerasjonX=4*config.pikselPerMeter,this.akselerasjonY=config.pikselPerMeter/100,this.liv=600,this.maxLiv=this.liv,this.poengForDrap=500,this.tidSidenForrigeAngrep=Number.MAX_VALUE,this.tidMellomAngrep=6}function FiendeRobot(t,e,i){Fiende.call(this,Atlas.typer.TING,"fiendeRobotOverkropp",t,e,i,0,2*config.pikselPerMeter),this.fartsgrenseX=2*config.pikselPerMeter,this.våpen=new Våpen(this,!1,Våpen.typer.ROBOTBRYSTKANON,0,0,0,0),this.relativtVåpenAnkerpunkt=[.6,.2],this.akselerasjonX=config.pikselPerMeter/80,this.deakselerasjonX=4*config.pikselPerMeter,this.akselerasjonY=config.pikselPerMeter/100,this.poengForDrap=100,this.angrepsPoeng=15,this.tidSidenForrigeAngrep=Number.MAX_VALUE,this.tidMellomAngrep=4,this.animasjonsVerdier={maxBeinUtslag:40},this.atlasBildeLag(1,!1,"fiendeRobotBein"),this.skalerLag(1,.9,.6),this.settRelativPosLag(1,.1,.43),this.roterLagRundt(1,.5,.15),this.atlasBildeLag(2,!1,"fiendeRobotBein"),this.skalerLag(2,.9,.6),this.settRelativPosLag(2,.1,.43),this.roterLagRundt(2,.5,.15),this.atlasBildeLag(3,!1,"fiendeRobotOverkropp")}function MønsterKnapp(t,e,i,s,n,r,l,a){MønsterObjekt.call(this,e,i,s,n),this.nårNede=r,this.nårSluppet=l,this.nårTrykket=a,this.tekst=new TekstObjekt(t,0,0),this.kantlinje={laget:!1}}function Spiller(t,e,i,s,n,r){Enhet.call(this,t,e,i,s,n,r),this.liv=400,this.maxLiv=this.liv,this.poeng=0,this.helsebar=new Statusbar(0,0,this.bredde,9,"green"),this.helsebar.lagKantLinje(1,"white"),this.akselerasjonX=config.pikselPerMeter/7.33,this.akselerasjonY=config.pikselPerMeter/22,this.våpen=new Våpen(this,Fiende.nåværendeFiender,Våpen.typer.M97RIFLE,0,0,.9*config.pikselPerMeter,0),this.relativtVåpenAnkerpunkt=[.61,.204],this.animasjonsVerdier={maxBeinUtslag:45},this.atlasBildeLag(1,!1,"kommandoKalleVenstreBein"),this.skalerLag(1,.7,.65),this.settRelativPosLag(1,-.08,.36),this.roterLagRundt(1,.5,.15),this.atlasBildeLag(2,!1,"kommandoKalleVenstreBein"),this.skalerLag(2,.7,.65),this.settRelativPosLag(2,-.08,.36),this.roterLagRundt(2,.5,.15),this.atlasBildeLag(3,!1,"kommandoKalleOverkropp"),this.atlasBildeLag(4,!1,"kommandoKalleVenstreArm"),this.settRelativPosLag(4,.3,.15),this.roterLagRundt(4,.5,.1),this.skalerLag(4,.65,.2,!0),this.atlasBildeLag(5,!1,"kommandoKalleHøyreArm"),this.settRelativPosLag(5,.08,.17),this.skalerLag(5,.65,.2,!0),this.effekter={blodflekker:[new Effekt(Effekt.typer.BLOOD,0,0,ctx.canvas.width,0),new Effekt(Effekt.typer.BLOOD,0,0,ctx.canvas.width,0),new Effekt(Effekt.typer.BLOOD,0,0,ctx.canvas.width,0)]},this.lyder={grynt:new Lyd(Lyd.typer.MANLIGGRYNT)}}function Terreng(t){BildeAtlasObjekt.call(this,t.atlas,t.bildeNavn,0,0,0,0),this.globalX=this.x,this.globalY=this.y,this.type=t,this.farge="black",this.settBreddeHøydeMedMinimum(this.bildeNavn,1,ctx.canvas.height),this.atlasBildeLag(0,!1,this.bildeNavn)}function Våpen(t,e,i,s,n,r,l){VerdensObjekt.call(this,i.atlas,i.navn,s,n,r,l),this.eier=t,this.mål=e,this.type=i,this.prosjektiler=[],this.tidSidenSisteSkudd=Number.MAX_VALUE/2,this.lyd=new Lyd(i.lydType),this.type.effektType&&(this.atlasBildeLag(1,this.type.effektType.atlas,this.type.effektType.bildeNavn),this.settSynlighetLag(1,!1),this.størrelseLag(1,this.type.effektStørrelse[0],this.type.effektStørrelse[1]),this.settRelativPosLag(1,this.type.relativtGeværløp[0]-this.type.effektStørrelse[0]/this.bredde*this.type.effektType.relativtAnkerpunkt[0],this.type.relativtGeværløp[1]-this.type.effektStørrelse[1]/this.høyde*this.type.effektType.relativtAnkerpunkt[1]))}function Prosjektil(t,e,i,s,n){this.eier=t,this.globalX=e,this.globalY=i,this.x=e-Spill.globalX,this.y=i-Spill.globalY,this.type=s,this.positivRetning=n,this.død=!1}function Hovedmeny(){this.fjesHopping={xFart:100,yFart:0,xAks:0,yAks:9.81}}function Lyd(t){this.lydType=t,this.loop=!1}function Spill(t,e){this.levelNummer=e,this.levelErOver=!1,this.tidMellomRunder=5,this.runde={nr:0,startet:!1,sluttet:!1,tidSidenForrige:0,tekstObjekt:new TekstObjekt("Runde ",4,4,"black","Stencil")},this.runde.tekstObjekt.høyde=32,this.runde.tekstObjekt.lagKantLinje(.5,"white"),this.visAnnonsering=!1,this.tidSomAnnonseringSkalVises=5,this.nåværendeAnnonseringsTid=0,this.annonseringsTittel=new TekstObjekt("",0,0,"black","Stencil"),this.annonseringsTittel.høyde=50,this.annonseringsTittel.lagKantLinje(.7,"white"),this.tilbakemeldingPoeng=new TekstObjekt("",0,0,"black","Stencil"),this.poengTekstObjekt=new TekstObjekt("Poeng: ",4,4,"black","Stencil"),this.poengTekstObjekt.lagKantLinje(.5,"white"),this.poengTekstObjekt.høyde=30,this.besteResultat={tekstObjekt:new TekstObjekt("Beste resultat: "+localStorage.getItem("besteResultat"),4,4,"black","Stencil"),skalTegnes:null!=localStorage.getItem("besteResultat")},this.besteResultat.tekstObjekt.lagKantLinje(.5,"white"),this.besteResultat.tekstObjekt.høyde=30,this.besteResultat.skalTegnes?(this.besteResultat.tekstObjekt.y=this.runde.tekstObjekt.høyde+8,this.poengTekstObjekt.y=this.besteResultat.tekstObjekt.y+this.besteResultat.tekstObjekt.høyde+4):(this.poengTekstObjekt.y=this.runde.tekstObjekt.høyde+8,this.besteResultat.tekstObjekt.y=this.poengTekstObjekt.y+this.poengTekstObjekt.høyde+4)}Inngangsdata.prototype.leggTilTrykkeEvent=function(t,e,i){if(t instanceof Array)for(var s=0;s<t.length;s++)this.leggTilTrykkeEvent(t[s],e,i instanceof Array&&i[s]||"keydown"===t[s]&&i);else this.tastatur[t][e]=i},Inngangsdata.prototype.leggTilMuseKlikkEvent=function(t,e,i){var s=void 0;t.addEventListener("mousedown",function(t){e(t),s=t.currentTarget}.bind(this)),t.addEventListener("mouseup",function(e){var n=this.hentMusePos(e,t),r=s.getBoundingClientRect();n.x>r.left&&n.y>r.top&&n.x<r.right&&n.y<r.bottom&&i(e),s=void 0}.bind(this))},Inngangsdata.prototype.håndtererMuseKlikkPåCanvas=function(){var t=void 0;inngangsdata.leggTilMuseKlikkEvent(ctx.canvas,function(e){var i=StatusHåndterer.nåværendeStatus.statusObjekt.alleKlikkbareObjekter;if(i)for(var s=0;s<i.length;s++){var n=i[s];if(this.sjekkOmMusePosErInnenforObjekt(this.hentMusePos(e,ctx.canvas),n)){t=n,n.nårNede&&n.nårNede();break}}}.bind(this),function(e){t&&(this.sjekkOmMusePosErInnenforObjekt(this.hentMusePos(e,ctx.canvas),t)&&t.nårTrykket&&t.nårTrykket(),t.nårSluppet&&t.nårSluppet(),t=void 0)}.bind(this))},function(){function t(){e()&&s.forEach(function(t){t()})}function e(){for(var t=!0,e=[n.lastet,r.JSONer,r.lyder],i=function(){var t=[],i=0;return e.forEach(function(e){e&&(t[i]=Object.keys(e),i++)}),t}(),s=0;s<i.length;s++)for(var l=0;l<i[s].length;l++)if(!e[s][i[s][l]]){t=!1;break}return t}function i(t){s.push(t)}window.tilbakekall={onresize:[]};var s=[],n={lastet:{},atlas:{last:function(t){r._last("bilder/atlas/"+t+".json",r.JSONer),n._last("atlas/"+t+".png")},hentJSON:function(t){return r.hent("bilder/atlas/"+t+".json",r.JSONer)},hentBilde:function(t){return n.hent("atlas/"+t+".png")}},last:function(t){t instanceof Array?t.forEach(function(t){n.hent(t)||n._last(t)}):n.hent(t)||n._last(t)},_last:function(e){var i=new Image;i.onload=function(){n.lastet[e]=i,t()},n.lastet[e]=!1,i.src="bilder/"+e},hent:function(t){return n.lastet[t]}},r={filer:{},XMLer:{},JSONer:{},lyder:{},_lastXML:function(e){var i=new XMLHttpRequest;i.onreadystatechange=function(){4===i.readyState&&200===i.status&&(r.XMLer[e]=i.responseXML,t())},r.XMLer[e]=!1,i.open("GET",e,!0),i.send()},_lastLyd:function(e){var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType="arraybuffer",i.onload=function(){lydctx.decodeAudioData(i.response,function(i){r.lyder[e]=i,t()})},r.lyder[e]=!1,i.send()},_last:function(e,i){i=i?i:r.filer;var s=new XMLHttpRequest;s.onreadystatechange=function(){4===s.readyState&&200===s.status&&(i[e]=s.responseText,t())},i[e]=!1,s.open("GET",e,!0),s.send()},hentLyd:function(t){return r.hent(t,r.lyder)},hent:function(t,e){return e=e?e:r.filer,e[t]}};window.Ressurser={"bildeHåndterer":{last:n.last,hent:n.hent,atlas:{last:n.atlas.last,hentJSON:n.atlas.hentJSON,hentBilde:n.atlas.hentBilde}},"filHåndterer":{last:{lyd:r._lastLyd,fil:r._last},hent:{fil:r.hent,lyd:r.hentLyd}},"nårRessurserKlareKall":i,ressurserLastet:e,"sjekkOmAlleLastetOgGjørTilbakekall":t}}();var Atlas={};Atlas.typer=function(){function t(t){Ressurser.bildeHåndterer.atlas.last(t),this.navn=t,this.data=!1,Ressurser.nårRessurserKlareKall(function(){this.data=JSON.parse(Ressurser.bildeHåndterer.atlas.hentJSON(this.navn))}.bind(this))}return t.prototype.hentJSON=function(){return JSON.parse(Ressurser.bildeHåndterer.atlas.hentJSON(this.navn))},t.prototype.hentBilde=function(){return Ressurser.bildeHåndterer.atlas.hentBilde(this.navn)},{TING:new t("KommandoKompeAtlas"),LANDSKAP:new t("landskap")}}(),BildeAtlasObjekt.prototype=Object.create(SkjemObjekt.prototype),BildeAtlasObjekt.prototype.constructor=BildeAtlasObjekt,BildeAtlasObjekt.tegnHjelpeLinje=function(t,e,i,s){ctx.save(),ctx.strokeStyle="black",ctx.beginPath(),ctx.moveTo(t,e),ctx.lineTo(i,s),ctx.stroke(),ctx.restore()},BildeAtlasObjekt.tegnGradient=function(t,e,i,s,n,r,l,a,o,h){ctx.save(),ctx.translate(n,r);var d=ctx.createLinearGradient(t,e,i,s);d.addColorStop(0,o),d.addColorStop(1,h),ctx.fillStyle=d,ctx.fillRect(0,0,l,a),ctx.restore()},BildeAtlasObjekt.prototype.lagBildeData=function(){if(!this.bildeData&&this.bredde&&this.høyde){var t=document.createElement("canvas");t.width=1e5,t.height=1e5;var e=t.getContext("2d");BildeAtlasObjekt.prototype.tegn.call(this,e),this.bildeData=e.getImageData(this.x||0,this.y,this.bredde,this.høyde)}},BildeAtlasObjekt.prototype.initLag=function(t,e){var i={atlas:this.atlas,bildeNavn:void 0,rotasjon:0,roterRundt:{x:.5,y:.5},relativ:{x:0,y:0},bredde:this.bredde,"høyde":this.høyde,reflekter:{x:!1,y:!1},vis:!0};this.lag.splice(t,e?1:0,i)},BildeAtlasObjekt.prototype.settSynlighetLag=function(t,e){var i=this.lag[t];i&&(i.vis=e)},BildeAtlasObjekt.prototype.atlasBildeLag=function(t,e,i,s){this.initLag(t,s);var n=this.lag[t];n.atlas=0==e?this.atlas:e,n.bildeNavn=i},BildeAtlasObjekt.prototype.reflekterLag=function(t,e,i){var s=this.lag[t].reflekter;s.x=e,s.y=i},BildeAtlasObjekt.prototype.roterLag=function(t,e,i){this.lag[t].rotasjon=e+(i?this.lag[t].rotasjon:0)},BildeAtlasObjekt.prototype.roterLagRundt=function(t,e,i){this.lag[t].roterRundt={x:e,y:i}},BildeAtlasObjekt.prototype.skalerLag=function(t,e,i,s){var n=this.lag[t];s?(n.bredde*=e,n.høyde*=i):(n.bredde=this.bredde*e,n.høyde=this.høyde*i)},BildeAtlasObjekt.prototype.settRelativPosLag=function(t,e,i){var s=this.lag[t];s.relativ.x=e,s.relativ.y=i},BildeAtlasObjekt.prototype.størrelseLag=function(t,e,i){var s=this.lag[t];s.bredde=e,s.høyde=i},BildeAtlasObjekt.prototype.tegnLag=function(t,e){if(t.bildeNavn){e=e?e:ctx;var i=t.atlas||this.atlas,s=i.data[t.bildeNavn],n=Ressurser.bildeHåndterer.atlas.hentBilde(i.navn);if(s&&n&&t.vis){var r=t.bredde,l=t.høyde;e.save(),e.translate(t.relativ.x*this.bredde-this.bredde/2+t.roterRundt.x*r,t.relativ.y*this.høyde-this.høyde/2+t.roterRundt.y*l),e.rotate(-t.rotasjon*(Math.PI/180)),e.scale(t.reflekter.x?-1:1,t.reflekter.y?-1:1),e.drawImage(n,s.x,s.y,s.bredde,s.høyde,t.roterRundt.x*-r,t.roterRundt.y*-l,r,l),e.restore()}}},BildeAtlasObjekt.prototype.tegn=function(t){t=t?t:ctx,t.save(),this.transformer(t),this.lag.forEach(function(e){this.tegnLag(e,t)}.bind(this)),t.restore()},BildeAtlasObjekt.prototype.settBreddeHøyde=function(t,e,i){if(i=i?i:this,e=e?e:this.atlas,t=t?t:this.bildeNavn,t&&e&&i){var s=e.data[t];i.bredde=0===i.bredde&&s.bredde/s.høyde*i.høyde||i.bredde,i.høyde=0===i.høyde&&s.høyde/s.bredde*i.bredde||i.høyde}},BildeAtlasObjekt.prototype.settBreddeHøydeMedMinimum=function(t,e,i,s,n){if(n=n?n:this,s=s?s:this.atlas,t=t?t:this.bildeNavn){var r=s.data[t];e/i<=r.bredde/r.høyde?(n.høyde=i,n.bredde=r.bredde/r.høyde*i):(n.bredde=e,n.høyde=r.høyde/r.bredde*e)}},MønsterObjekt.prototype=Object.create(SkjemObjekt.prototype),MønsterObjekt.prototype.constructor=MønsterObjekt,MønsterObjekt.prototype.tegn=function(){this.mønster&&(ctx.save(),ctx.fillStyle=this.mønster,this.transformer(),ctx.fillRect(-this.bredde/2,-this.høyde/2,this.bredde,this.høyde),ctx.restore())},SkjemObjekt.prototype.transformer=function(t){t=t?t:ctx,t.translate(this.x+this.roterRundt.x*this.bredde,this.y+this.roterRundt.y*this.høyde),t.rotate(-(this.rotasjon*(Math.PI/180))),t.scale(this.skalar.x*(this.reflekter.x?-1:1),this.skalar.y*(this.reflekter.y?-1:1))},Statusbar.prototype=Object.create(SkjemObjekt.prototype),Statusbar.prototype.constructor=Statusbar,Statusbar.prototype.lagKantLinje=function(t,e){this.kantlinje.lagd=!0,this.kantlinje.tykkelse=t,this.kantlinje.fillStyle=e},Statusbar.prototype.tegn=function(){var t=this.bredde/2,e=this.høyde/2;ctx.save(),this.transformer(),this.kantlinje.lagd&&(ctx.fillStyle=this.kantlinje.fillStyle,ctx.fillRect(-this.kantlinje.tykkelse-t,-this.kantlinje.tykkelse-e,2*this.kantlinje.tykkelse+2*t,2*this.kantlinje.tykkelse+2*e)),ctx.fillStyle=this.bakgrunnsfarge,ctx.fillRect(-t,-e,2*t,2*e),ctx.fillStyle=this.farge,this.nåværendeProssess>0&&ctx.fillRect(-t,-e,2*this.nåværendeProssess*t,2*e),ctx.restore()},TekstObjekt.prototype=Object.create(SkjemObjekt.prototype),TekstObjekt.prototype.constructor=TekstObjekt,TekstObjekt.prototype.transformer=function(){SkjemObjekt.prototype.transformer.call(this),ctx.textBaseline=this.textBaseline,ctx.textAlign=this.textAlign,ctx.font=this.høyde+"px "+this.font,ctx.fillStyle=this.fillStyle},TekstObjekt.prototype.settBreddeAvTekst=function(){ctx.save(),this.transformer(),this.bredde=ctx.measureText(this.tekst).width,ctx.restore()},TekstObjekt.prototype.sentrerTeksten=function(){this.settBreddeAvTekst(),this.x-=this.bredde/2,this.y-=this.høyde/2},TekstObjekt.prototype.lagKantLinje=function(t,e){this.kantlinje.tykkelse=t,this.kantlinje.strokeStyle=e,this.kantlinje.laget=!0},TekstObjekt.prototype.tegn=function(){ctx.save(),this.transformer(),ctx.fillText(this.tekst,-this.bredde/2,-this.høyde/2),this.kantlinje.laget&&(ctx.strokeStyle=this.kantlinje.strokeStyle,ctx.lineWidth=this.kantlinje.tykkelse,ctx.strokeText(this.tekst,-this.bredde/2,-this.høyde/2)),ctx.restore()},VerdensObjekt.prototype=Object.create(BildeAtlasObjekt.prototype),VerdensObjekt.prototype.constructor=VerdensObjekt,VerdensObjekt.prototype.oppdater=function(){this.x=this.globalX-Spill.globalX,this.y=this.globalY-Spill.globalY},Effekt.prototype=Object.create(BildeAtlasObjekt.prototype),Effekt.prototype.constructor=Effekt,Effekt.prototype.oppdater=function(){var t=0;return function(){this.skalTegnes&&(t+=klokke.delta)>this.varighet&&(this.skalTegnes=!1,t=0)}}(),Effekt.prototype.tegn=function(){this.skalTegnes&&BildeAtlasObjekt.prototype.tegn.call(this)},Enhet.prototype=Object.create(VerdensObjekt.prototype),Enhet.prototype.constructor=Enhet,Enhet.gravitasjon=9.81,Enhet.prototype.settAkselerasjon=function(t,e){(this.fartX>-this.fartsgrenseX||1===t)&&(this.fartX<this.fartsgrenseX||-1===t)?this.nåværendeAkselerasjonX=t*e*config.pikselPerMeter:(this.nåværendeAkselerasjonX=0,this.fartX=this.retningFartX*this.fartsgrenseX),this.fartX*this.nåværendeAkselerasjonX<0&&(this.nåværendeAkselerasjonX+=this.nåværendeAkselerasjonX/Math.abs(this.nåværendeAkselerasjonX)*this.deakselerasjonX)},Enhet.prototype.hopp=function(t){this.y+this.høyde+5>this.terrengHøyde&&this.y+this.høyde-5<this.terrengHøyde&&(this.fartY=t*config.pikselPerMeter)},Enhet.prototype.taSkade=function(t){this.liv-=t,this.liv<0&&this.drep()},Enhet.prototype.drep=function(){this.død=!0},Enhet.prototype.sjekkKollisjonMedEnheter=function(t){for(var e=0;e<t.length;e++){var i=t[e];i!==this&&this.erSpawnet&&!this.død&&i.erSpawnet&&!i.død&&i.globalX+i.bredde>this.globalX&&i.globalX<this.globalX+this.bredde}},Enhet.prototype.oppdater=function(){this.oppdaterGlobalX(),this.terrengHøyde=Terreng.nåværende.hentLineærY(this.globalX+this.bredde/2),this.oppdaterGlobalY(),VerdensObjekt.prototype.oppdater.call(this)},Enhet.prototype.tegn=function(){BildeAtlasObjekt.prototype.tegn.call(this)},Enhet.prototype.oppdaterGlobalX=function(){this.fartX+=this.nåværendeAkselerasjonX*klokke.delta,this.fartX*this.nåværendeAkselerasjonX<0&&-(this.deakselerasjonX*klokke.delta)<this.fartX&&this.fartX<this.deakselerasjonX*klokke.delta&&(this.fartX=0),this.nåværendeAkselerasjonX=Math.abs(this.fartX)>1?-this.retningFartX*this.deakselerasjonX:0,this.globalX+=this.fartX*klokke.delta,this.retningFartX=0!==this.fartX?this.fartX/Math.abs(this.fartX):this.retningFartX},Enhet.prototype.oppdaterGlobalY=function(){this.globalY-=this.fartY*klokke.delta,this.globalY+this.høyde>this.terrengHøyde&&(this.globalY=this.terrengHøyde-this.høyde),this.globalY+this.høyde!==this.terrengHøyde?this.fartY-=config.pikselPerMeter*Enhet.gravitasjon*klokke.delta:this.fartY=0},Fiende.prototype=Object.create(Enhet.prototype),Fiende.prototype.constructor=Fiende,Fiende.nåværendeFiender=[],Fiende.sorterAlleLagdeFiender=function(){Fiende.nåværendeFiender.sort(function(t,e){return t.globalX-e.globalX})},Fiende.prototype.spawn=function(){this.erSpawnet=!0,Fiende.nåværendeFiender.push(this)},Fiende.prototype.drep=function(){Enhet.prototype.drep.call(this),Fiende.nåværendeFiender.splice(Fiende.nåværendeFiender.indexOf(this),1)},Fiende.prototype.oppdater=function(){this.retningFartX=this.mål.globalX<this.globalX?-1:1,this.reflekter.x=this.retningFartX<0,Enhet.prototype.oppdater.call(this),this.helsebar.x=this.x,this.helsebar.y=this.y-20,this.helsebar.nåværendeProssess=this.liv/this.maxLiv},Fiende.prototype.tegn=function(){Enhet.prototype.tegn.call(this),this.helsebar.tegn()},FiendeBølge.prototype.oppdater=function(){this.tidSidenSistFiende+=klokke.delta,this.tidSidenSistFiende>this.sekundPerFiende&&(this.spawnFiende(),this.tidSidenSistFiende=0);for(var t=0;t<this.bølgeFiender.length;t++){var e=this.bølgeFiender[t];if(e.død){if(this.bølgeFiender.splice(t,1),0==this.uSpawnedeFiender.length&&0==this.bølgeFiender.length){this.erTom=!0;break}t--}else e.oppdater()}},FiendeBølge.prototype.spawnFiende=function(){if(this.uSpawnedeFiender.length>0){var t=this.uSpawnedeFiender.shift();t.globalX=Spill.globalX+ctx.canvas.width/2+ctx.canvas.width*(Math.random()>.5?1:-1),t.akselerasjonX*=Math.random()+.5,t.fartsgrenseX*=Math.random()+.5,t.spawn(),this.bølgeFiender.push(t)}},FiendeBølge.prototype.tegn=function(){this.bølgeFiender.forEach(function(t){t&&t.tegn()})},FiendeKompebu.prototype=Object.create(Fiende.prototype),FiendeKompebu.prototype.constructor=FiendeKompebu,FiendeKompebu.prototype.oppdater=function(){Fiende.prototype.oppdater.call(this),this.våpen.oppdater(this),this.tidSidenForrigeAngrep+=klokke.delta,this.x<0||this.x+this.bredde>ctx.canvas.width||Math.abs(this.mål.globalX+this.mål.bredde/2-(this.globalX+this.bredde/2))-3*config.pikselPerMeter>this.bredde/2+this.mål.bredde/2?this.mål.globalX>this.globalX?this.settAkselerasjon(1,this.akselerasjonX):this.mål.globalX<this.globalX&&this.settAkselerasjon(-1,this.akselerasjonX):(this.retningFartX=this.mål.globalX<this.globalX?-1:1,this.tidSidenForrigeAngrep>this.tidMellomAngrep&&(this.skyt(),this.tidSidenForrigeAngrep=0))},FiendeKompebu.prototype.tegn=function(){this.våpen.tegn(),Fiende.prototype.tegn.call(this)},FiendeKompebu.prototype.skyt=function(){this.våpen.skyt()},FiendeRobot.prototype=Object.create(Fiende.prototype),FiendeRobot.prototype.constructor=FiendeRobot,FiendeRobot.prototype.oppdater=function(){Fiende.prototype.oppdater.call(this),this.våpen.oppdater(this),this.gåAnimasjon(),this.tidSidenForrigeAngrep+=klokke.delta,Math.abs(this.mål.globalX+this.mål.bredde/2-(this.globalX+this.bredde/2))>this.bredde/2+this.mål.bredde/2?this.mål.globalX>this.globalX?this.settAkselerasjon(1,this.akselerasjonX):this.mål.globalX<this.globalX&&this.settAkselerasjon(-1,this.akselerasjonX):(this.retningFartX=this.mål.globalX<this.globalX?-1:1,this.tidSidenForrigeAngrep>this.tidMellomAngrep&&(this.mål.taSkade(this.angrepsPoeng),this.tidSidenForrigeAngrep=0))},FiendeRobot.prototype.tegn=function(){Fiende.prototype.tegn.call(this),this.våpen.tegn()},FiendeRobot.prototype.skyt=function(){this.våpen.skyt()},FiendeRobot.prototype.gåAnimasjon=function(){var t=1;return function(){var e,i=this.lag[2].rotasjon/this.animasjonsVerdier.maxBeinUtslag;(e=Math.abs(this.fartX))<1?(this.roterLag(1,-10*this.lag[1].rotasjon*klokke.delta,!0),this.roterLag(2,-10*this.lag[2].rotasjon*klokke.delta,!0)):(i>1&&(t=-1),-1>i&&(t=1),this.roterLag(1,-.5*t*e*klokke.delta,!0),this.roterLag(2,.5*t*e*klokke.delta,!0))}}(),MønsterKnapp.prototype=Object.create(MønsterObjekt.prototype),MønsterKnapp.prototype.constructor=MønsterKnapp,MønsterKnapp.prototype.oppdater=function(){this.tekst.x=this.x+this.bredde/2,this.tekst.y=this.y+this.høyde/2,this.tekst.sentrerTeksten(),0===this.bredde&&(this.bredde=this.tekst.bredde+(this.kantlinje.laget?2*this.kantlinje.tykkelse:3))},MønsterKnapp.prototype.tegn=function(){MønsterObjekt.prototype.tegn.call(this),this.tekst&&this.tekst.tegn(),this.kantlinje.laget&&(ctx.save(),this.transformer(ctx),ctx.translate(-(this.bredde/2),-(this.høyde/2)),ctx.fillStyle=this.kantlinje.fillStyle,ctx.fillRect(0,0,this.bredde,this.kantlinje.tykkelse),ctx.fillRect(this.bredde-this.kantlinje.tykkelse,0,this.kantlinje.tykkelse,this.høyde),ctx.fillRect(0,0,this.kantlinje.tykkelse,this.høyde),ctx.fillRect(0,this.høyde-this.kantlinje.tykkelse,this.bredde,this.kantlinje.tykkelse),ctx.restore())},MønsterKnapp.prototype.lagKantLinje=function(t,e){this.kantlinje.tykkelse=t,this.kantlinje.fillStyle=e,this.kantlinje.laget=!0},Spiller.prototype=Object.create(Enhet.prototype),Spiller.prototype.constructor=Spiller,Spiller.prototype.init=function(){inngangsdata.leggTilTrykkeEvent("keydown",68,function(){this.settAkselerasjon(1,this.akselerasjonX),this.reflekter.x=!1}.bind(this)),inngangsdata.leggTilTrykkeEvent("keydown",65,function(){this.settAkselerasjon(-1,this.akselerasjonX),this.reflekter.x=!0}.bind(this)),inngangsdata.leggTilTrykkeEvent("keydown",87,function(){this.hopp(this.akselerasjonY)}.bind(this)),inngangsdata.leggTilTrykkeEvent("keydown",32,this.skyt.bind(this))},Spiller.prototype.nårMotstanderDrept=function(t){this.poeng+=t.poengForDrap},Spiller.prototype.gåAnimasjon=function(){var t=1;return function(){var e,i=this.lag[2].rotasjon/this.animasjonsVerdier.maxBeinUtslag;(e=Math.abs(this.fartX))<1||this.globalY+10>Terreng.nåværende.hentLineærY(this.globalX+this.bredde/2)?(this.roterLag(1,-10*this.lag[1].rotasjon*klokke.delta,!0),this.roterLag(2,-10*this.lag[2].rotasjon*klokke.delta,!0)):(i>1&&(t=-1),-1>i&&(t=1),this.roterLag(1,-.5*t*e*klokke.delta,!0),this.roterLag(2,.5*t*e*klokke.delta,!0))}}(),Spiller.prototype.oppdater=function(){this.x<200?(Spill.globalX+=this.fartX*klokke.delta,this.x=200):this.x>ctx.canvas.width-200-this.bredde&&(Spill.globalX+=this.fartX*klokke.delta,this.x=ctx.canvas.width-200-this.bredde),Enhet.prototype.oppdater.call(this),this.gåAnimasjon(),this.helsebar.x=this.x,this.helsebar.y=this.y-30,this.helsebar.nåværendeProssess=this.liv/this.maxLiv,this.våpen.oppdater(this);for(var t=0;t<this.effekter.blodflekker.length;t++)this.effekter.blodflekker[t].oppdater()},Spiller.prototype.tegn=function(){Enhet.prototype.tegn.call(this),this.våpen.tegn(),ctx.save(),this.transformer(),this.tegnLag(this.lag[this.lag.length-2]),this.tegnLag(this.lag[this.lag.length-1]),ctx.restore(),this.helsebar.tegn();for(var t=0;t<this.effekter.blodflekker.length;t++)this.effekter.blodflekker[t].tegn()},Spiller.prototype.skyt=function(){this.våpen.skyt()},Spiller.prototype.taSkade=function(t){Enhet.prototype.taSkade.call(this,t),this.lyder.grynt.avspill();for(var e=0;e<this.effekter.blodflekker.length;e++){var i=this.effekter.blodflekker[e];if(!i.skalTegnes){i.x=ctx.canvas.width*(Math.random()-.5),i.y=ctx.canvas.height*(Math.random()-.5),i.rotasjon=360*Math.random(),i.varighet=i.type.varighet*(Math.random()+.8),i.skalTegnes=!0;break}}},Terreng.prototype=Object.create(BildeAtlasObjekt.prototype),Terreng.prototype.constructor=Terreng,Terreng.nåværende=null,Terreng.prototype.settSomNåværende=function(){Terreng.nåværende=this},Terreng.prototype.init=function(){this.type.nøkkelpunktKart=this.type.initNøkkelpunktKart()},Terreng.prototype.oppdater=function(){Terreng.nåværende.globalX=Spill.globalX;var t=Math.floor(this.globalX/(this.bredde/this.type.komponenter));this.x=this.bredde/this.type.komponenter*t-this.globalX},Terreng.prototype.tegn=function(){BildeAtlasObjekt.prototype.tegn.call(this);var t=this.x;this.x+=this.bredde,BildeAtlasObjekt.prototype.tegn.call(this),this.x=t},Terreng.prototype.tegnLineær=function(){ctx.beginPath();for(var t=0;t<this.type.nøkkelpunktKart.length;t++){var e=this.type.nøkkelpunktKart[t],i=t>0?ctx.lineTo.bind(ctx):ctx.moveTo.bind(ctx);i(e[0],e[1])}for(var s=this.type.nøkkelpunktKart.length-1;s>=0;s--){e=this.type.nøkkelpunktKart[s];var n=4===e.length&&e[2]||e[1];ctx.lineTo(e[0],e[1]+n)}ctx.fill()},Terreng.prototype.tegnSomKurve=function(){ctx.beginPath();for(var t=0;t<this.type.nøkkelpunktKart.length;t++){var e=this.type.nøkkelpunktKart[t];if(t>0){var i=this.type.nøkkelpunktKart[t-1],s=e[0]-i[0];ctx.bezierCurveTo(i[0]+s/2,i[1],i[0]+s/2,e[1],e[0],e[1])}else ctx.moveTo(e[0],e[1])}ctx.stroke()},Terreng.prototype.hentLineærY=function(t){for(var e,i,s,n,r=0,l=0;l<this.type.nøkkelpunktKart.length&&(e=this.type.nøkkelpunktKart[l],i=this.type.nøkkelpunktKart[l+1],!(t>=e[0]&&t<(i&&i[0]||e[0])));l++){if(0===l&&t<e[0]){e=null,i=null;break}e=null,i=null}return e&&i&&(s=i[0]-e[0],n=i[1]-e[1],r=n/s||0),r*(t-(e&&e[0]||0))+(e&&e[1]||Number.MAX_VALUE)},Våpen.prototype=Object.create(VerdensObjekt.prototype),Våpen.prototype.constructor=Våpen,Våpen.prototype.skyt=function(){this.tidSidenSisteSkudd>1/this.type.skuddPerSekund&&(this.prosjektiler.push(new Prosjektil(this,this.globalX+.3*(this.reflekter.x?-1:1)*this.bredde*this.type.relativtGeværløp[0],this.globalY+this.høyde*this.type.relativtGeværløp[1],this.type.prosjektilType,!this.reflekter.x)),this.tidSidenSisteSkudd=0,this.settSynlighetLag(1,!0),this.lyd&&this.lyd.avspill())},Våpen.prototype.oppdater=function(t){if(t=t?t:this.eier,this.tidSidenSisteSkudd+=klokke.delta,this.type.effektType&&this.tidSidenSisteSkudd>this.type.effektType.varighet&&this.settSynlighetLag(1,!1),t){var e=Math.abs((t.reflekter.x?1:0)-t.relativtVåpenAnkerpunkt[0])*t.bredde,i=Math.abs((t.reflekter.x?1:0)-this.type.relativtAnkerpunkt[0])*this.bredde,s=t.relativtVåpenAnkerpunkt[1]*t.høyde,n=this.type.relativtAnkerpunkt[1]*this.høyde;this.globalX=t.globalX+e-i,this.globalY=t.globalY+s-n,this.reflekter.x=t.reflekter.x}VerdensObjekt.prototype.oppdater.call(this);for(var r=0;r<this.prosjektiler.length;r++){var l=this.prosjektiler[r];l.død?this.prosjektiler.splice(r,1):l.oppdater(this.mål)}},Våpen.prototype.tegn=function(){this.prosjektiler.forEach(function(t){t.tegn()}),BildeAtlasObjekt.prototype.tegn.call(this)},Prosjektil.prototype.oppdater=function(t){t&&this.sjekkKollisjon(t),this.globalX+=(this.positivRetning?1:-1)*this.type.meterPerSekund*config.pikselPerMeter*klokke.delta,(this.x>ctx.canvas.width||this.x<-this.type.bredde)&&(this.død=!0),this.x=this.globalX-Spill.globalX},Prosjektil.prototype.hentKulePunkt=function(){return[this.globalX+(this.positivRetning?1:0)*this.type.bredde,this.globalY+this.type.høyde/2]},Prosjektil.prototype.sjekkKollisjon=function(t){var e=this.hentKulePunkt();if(t.constructor!==Array){if(!t.død&&e[0]>t.globalX&&e[0]<t.globalX+t.bredde&&e[1]>t.globalY&&e[1]<t.globalY+t.høyde){if(this.død=!0,t.truffetAvKuleLyd&&t.truffetAvKuleLyd.avspill(),t.taSkade(this.type.skade),t.død){var i=this.eier;if(i){var s=i.eier;s&&s.nårMotstanderDrept&&s.nårMotstanderDrept(t)}}return!0}return!1}for(var n=0;n<t.length&&!this.sjekkKollisjon(t[n]);n++);},Prosjektil.prototype.tegn=function(){ctx.save(),ctx.fillStyle=this.type.farge,ctx.translate(this.x,this.y),ctx.beginPath(),ctx.moveTo(0,0),ctx.lineTo(this.type.bredde,0),ctx.lineTo(this.type.bredde,this.type.høyde),ctx.lineTo(0,this.type.høyde),ctx.fill(),ctx.restore()};var config={pikselPerMeter:110};Hovedmeny.prototype.init=function(){this.overskrift=new TekstObjekt("Kommando Kompe",0,0,"black","Stencil"),this.bunnTekst=new TekstObjekt("Av Ole Martin Ruud og Emil Barkeland",0,0,"black","Stencil"),this.spillKnapp=new MønsterKnapp("NYTT SPILL",0,0,300,70,function(){this.tekst.fillStyle="white",this.tekst.kantlinje.strokeStyle="black";var t=4;this.skalar.y=this.skalar.x=(this.bredde-2*t)/this.bredde},function(){this.tekst.fillStyle="black",this.tekst.kantlinje.strokeStyle="white",this.skalar.x=this.skalar.y=1},function(){StatusHåndterer.byttStatus(StatusHåndterer.typer.SPILL,["skogland",1])}),this.kommandoKompeFjes=new BildeAtlasObjekt(Atlas.typer.TING,"KommandoKompeAnsikt",0,200,200,0),this.kommandoKompeFjes.rotasjon=12,
this.alleKlikkbareObjekter=[this.spillKnapp],this.overskrift.høyde=70,this.overskrift.lagKantLinje(1,"white"),this.overskrift.settBreddeAvTekst(),this.bunnTekst.høyde=12,this.spillKnapp.lagKantLinje(2,"white"),this.spillKnapp.mønster=Mønster.typer.METALL.mønster,this.spillKnapp.tekst.fillStyle="black",this.spillKnapp.tekst.font="Stencil",this.spillKnapp.tekst.høyde=50,this.spillKnapp.tekst.lagKantLinje(1,"white"),this.lyd=new Lyd(Lyd.typer.BAKGRUNN),this.lyd.loop=!0},Hovedmeny.prototype.oppdater=function(){var t=ctx.canvas.width/2,e=ctx.canvas.height/2;this.overskrift.x=t-this.overskrift.bredde/2,this.overskrift.y=e-this.overskrift.høyde/2-(100+this.overskrift.høyde),this.bunnTekst.y=2*e-this.bunnTekst.høyde-4,this.bunnTekst.x=4,this.spillKnapp.x=t-this.spillKnapp.bredde/2,this.spillKnapp.y=e-this.spillKnapp.høyde/2-50,this.fjesHopping.yFart+=this.fjesHopping.yAks,this.fjesHopping.xFart+=this.fjesHopping.xAks,this.kommandoKompeFjes.y+this.kommandoKompeFjes.høyde>2*e&&(this.fjesHopping.yFart=-400),(this.kommandoKompeFjes.x<0||this.kommandoKompeFjes.x+this.kommandoKompeFjes.bredde>2*t)&&(this.fjesHopping.xFart=-this.fjesHopping.xFart,this.kommandoKompeFjes.reflekter.x=!this.kommandoKompeFjes.reflekter.x,this.kommandoKompeFjes.rotasjon=-this.kommandoKompeFjes.rotasjon),this.kommandoKompeFjes.x+=this.fjesHopping.xFart*klokke.delta,this.kommandoKompeFjes.y+=this.fjesHopping.yFart*klokke.delta,this.spillKnapp.oppdater()},Hovedmeny.prototype.tegn=function(){ctx.fillStyle=Mønster.typer.KAMUFLASJE.mønster,ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),this.spillKnapp.tegn(),this.overskrift.tegn(),this.kommandoKompeFjes.tegn(),this.bunnTekst.tegn()},Lyd.prototype.lagKilde=function(){var t=lydctx.createBufferSource();return t.buffer=this.lydType.hentBuffer(),t.connect(lydctx.destination),t.loop=this.loop,t},Lyd.prototype.avspill=function(){this.lagKilde().start(lydctx.currentTime)};var KommandoKompe=function(){function t(){o.oppdater(),d.oppdater(),s.statusByttet?(i&&window.cancelAnimationFrame(i),e()):(s.oppdater(),s.tegn(),i=requestAnimationFrame(t))}function e(){n.body.appendChild(r),o.sisteTid=Date.now(),s.statusByttet&&(s.nåværendeStatus=s.nybyttetStatus,s.statusByttet=!1),s.init(),d.håndtererMuseKlikkPåCanvas(),t()}var i,s={nybyttetStatus:void 0,"nåværendeStatus":void 0,statusByttet:!1,typer:function(){function t(t){this.funksjonForNyttStatusObjekt=t,this.statusObjekt=void 0}return{SPILL:new t(function(t){return new Spill(t[0],t[1])}),HOVEDMENY:new t(function(t){return new Hovedmeny})}}(),byttStatus:function(t,e){t.statusObjekt=t.funksjonForNyttStatusObjekt(e),s.nybyttetStatus=t,s.statusByttet=!0},init:function(){s.nåværendeStatus.statusObjekt.init()},oppdater:function(){s.nåværendeStatus.statusObjekt.oppdater()},tegn:function(){s.nåværendeStatus.statusObjekt.tegn()}},n=window.document,r=n.createElement("canvas"),l=r.getContext("2d"),a=function(){try{return window.AudioContext=window.AudioContext||window.webkitAudioContext,new AudioContext}catch(t){alert("Du kan ikke få lyd,\n synd det pølsa! \nBytt nettleser!")}}(),o={"nå":0,sisteTid:0,tidsganger:1,delta:0,oppdater:function(){this.nå=Date.now(),this.delta=(this.nå-this.sisteTid)/1e3*this.tidsganger,this.sisteTid=this.nå}},h=window.tilbakekall,d=new Inngangsdata;r.width=window.innerWidth,r.height=window.innerHeight,window.onresize=function(t){r.width=window.innerWidth,r.height=window.innerHeight,h.onresize.forEach(function(t){t()})},s.byttStatus(s.typer.HOVEDMENY),Ressurser.nårRessurserKlareKall(e),window.ctx=l,window.lydctx=a,window.klokke=o,window.inngangsdata=d,window.StatusHåndterer=s};addEventListener("DOMContentLoaded",function(){KommandoKompe()}),Spill.prototype.lagNyFiendeBølge=function(){this.runde.nr++;for(var t=[],e=0,i=1.7*this.runde.nr;i>e;e++)t[e]=this.runde.nr%3==0&&e+1>i?1:0;this.fiendeBølge=new FiendeBølge(this.nåværendeFiendeMål,1e3,200,[FiendeRobot,FiendeKompebu],t,1.7);var s=ctx.canvas.width/2,n=ctx.canvas.height/2;this.visAnnonsering=!0,this.nåværendeAnnonseringsTid=0,this.annonseringsTittel.tekst=this.runde.nr%3==0?this.runde>3?"Gjør deg klar, Dagny kommer på ny!!":"Å nei!! Dagny kommer!!":"Runde "+this.runde.nr,this.annonseringsTittel.x=s,this.annonseringsTittel.y=.4*n,this.annonseringsTittel.sentrerTeksten(),this.runde.sluttet=!1,this.runde.startet=!0},Spill.prototype.init=function(){this.runde.nr=0,this.tilMenyen=new MønsterKnapp("EXIT",ctx.canvas.width-5-120,5,120,60,function(){this.tekst.fillStyle="white",this.tekst.kantlinje.strokeStyle="black";var t=4;this.skalar.y=this.skalar.x=(this.bredde-2*t)/this.bredde},function(){this.tekst.fillStyle="black",this.tekst.kantlinje.strokeStyle="white",this.skalar.x=this.skalar.y=1},function(){var t;((t=null==localStorage.getItem("besteResultat"))||t<this.spiller.poeng)&&localStorage.setItem("besteResultat",this.spiller.poeng),StatusHåndterer.byttStatus(StatusHåndterer.typer.HOVEDMENY)}.bind(this)),this.tilMenyen.lagKantLinje(2,"white"),this.tilMenyen.mønster=Mønster.typer.METALL.mønster,this.tilMenyen.tekst.fillStyle="black",this.tilMenyen.tekst.font="Stencil",this.tilMenyen.tekst.høyde=50,this.tilMenyen.tekst.lagKantLinje(1,"white"),this.spillKnapp=new MønsterKnapp("NYTT SPILL",-400,-100,300,70,function(){this.tekst.fillStyle="white",this.tekst.kantlinje.strokeStyle="black";var t=4;this.skalar.y=this.skalar.x=(this.bredde-2*t)/this.bredde},function(){this.tekst.fillStyle="black",this.tekst.kantlinje.strokeStyle="white",this.skalar.x=this.skalar.y=1},function(){StatusHåndterer.byttStatus(StatusHåndterer.typer.SPILL,["skogland",1])}),this.spillKnapp.lagKantLinje(2,"white"),this.spillKnapp.mønster=Mønster.typer.METALL.mønster,this.spillKnapp.tekst.fillStyle="black",this.spillKnapp.tekst.font="Stencil",this.spillKnapp.tekst.høyde=50,this.spillKnapp.tekst.lagKantLinje(1,"white"),this.terreng=new Terreng(Terreng.typer.URBAN),this.terreng.settSomNåværende(),Spill.globalX=0,Spill.globalY=0,this.spiller=new Spiller(Atlas.typer.TING,"kommandoKalleOverkropp",2*config.pikselPerMeter,ctx.canvas.height,0,1.8*config.pikselPerMeter,0),this.nåværendeFiendeMål=this.spiller,this.fiendeBølge={},this.lagNyFiendeBølge(),this.runde.startet=!0,this.terreng.init(),this.spiller.init(),this.alleKlikkbareObjekter=[this.tilMenyen,this.spillKnapp]},Spill.prototype.oppdater=function(){if(this.tilMenyen.oppdater(),this.spiller.død){var t=ctx.canvas.width/2,e=ctx.canvas.height/2;this.annonseringsTittel.settBreddeAvTekst(),this.visAnnonsering=!0,this.nåværendeAnnonseringsTid=0,this.annonseringsTittel.tekst="Du døde! Prøv igjen!",this.tilMenyen.x=t-this.tilMenyen.bredde/2,this.tilMenyen.y=e,this.spillKnapp.x=t-this.spillKnapp.bredde/2,this.spillKnapp.y=e-this.tilMenyen.høyde-20,this.spillKnapp.oppdater(),this.annonseringsTittel.x=t,this.annonseringsTittel.y=.4*e,this.annonseringsTittel.sentrerTeksten(),this.tilbakemeldingPoeng.høyde=this.annonseringsTittel.høyde,this.tilbakemeldingPoeng.lagKantLinje(1,"white"),this.tilbakemeldingPoeng.tekst="Du fikk "+this.spiller.poeng+" poeng",this.tilbakemeldingPoeng.x=t,this.tilbakemeldingPoeng.y=.6*e,this.tilbakemeldingPoeng.sentrerTeksten();var i;((i=null==localStorage.getItem("besteResultat"))||i<this.spiller.poeng)&&(localStorage.setItem("besteResultat",this.spiller.poeng),this.besteResultat.tekstObjekt.tekst="Beste Resultat: "+this.spiller.poeng)}else{if(this.terreng.oppdater(),this.spiller.oppdater(),this.poengTekstObjekt.tekst="Poeng : "+this.spiller.poeng,this.runde.tekstObjekt.tekst="Runde "+this.runde.nr,this.fiendeBølge.erTom&&!this.runde.sluttet){this.runde.sluttet=!0;var t=ctx.canvas.width/2,e=ctx.canvas.height/2;this.annonseringsTittel.settBreddeAvTekst(),this.visAnnonsering=!0,this.nåværendeAnnonseringsTid=0,this.annonseringsTittel.tekst="Runde "+this.runde.nr+" ferdig!",this.annonseringsTittel.x=t,this.annonseringsTittel.y=.4*e,this.annonseringsTittel.sentrerTeksten()}this.runde.sluttet&&(this.runde.tidSidenForrige+=klokke.delta)>this.tidMellomRunder&&(this.runde.tidSidenForrige=0,this.lagNyFiendeBølge()),this.runde.startet&&this.fiendeBølge.oppdater(),this.visAnnonsering&&(this.nåværendeAnnonseringsTid+=klokke.delta)>this.tidSomAnnonseringSkalVises&&(this.nåværendeAnnonseringsTid=0,this.visAnnonsering=!1)}},Spill.prototype.tegn=function(){ctx.fillStyle="white",ctx.fillRect(0,0,ctx.canvas.width,ctx.canvas.height),this.terreng.tegn(),this.fiendeBølge.tegn(),this.spiller.tegn(),this.poengTekstObjekt.tegn(),this.runde.tekstObjekt.tegn(),this.besteResultat.skalTegnes&&this.besteResultat.tekstObjekt.tegn(),this.tilMenyen.tegn(),this.spiller.død&&(this.spillKnapp.tegn(),this.tilbakemeldingPoeng.tegn()),this.visAnnonsering&&this.annonseringsTittel.tegn()};var Mønster={};Mønster.typer=function(){function t(t,e){this.atlas=t,this.bildeNavn=e,this.mønster=!1,Ressurser.nårRessurserKlareKall(function(){var t=this.atlas.hentJSON()[this.bildeNavn],e=document.createElement("canvas"),i=e.getContext("2d");e.width=t.bredde,e.height=t.høyde,i.drawImage(this.atlas.hentBilde(),t.x,t.y,t.bredde,t.høyde,0,0,t.bredde,t.høyde),this.mønster=i.createPattern(e,"repeat")}.bind(this))}return{KAMUFLASJE:new t(Atlas.typer.TING,"kamuflasjeMonster"),METALL:new t(Atlas.typer.TING,"metallMonster")}}(),Lyd.typer=function(){function t(t){Ressurser.filHåndterer.last.lyd("lyder/"+t),this.lydNavn=t,this.hentBuffer=function(){return Ressurser.filHåndterer.hent.lyd("lyder/"+this.lydNavn)}}return{BAKGRUNN:new t("menyBakgrunn.mp3"),SUBMACHINEGUN:new t("submachinegun.mp3"),PISTOL:new t("pistol.mp3"),MANLIGGRYNT:new t("manligGrynt.mp3"),SKUDDMEDLADING:new t("sniper.mp3")}}(),Terreng.typer=function(){function t(t,e,i,s){this.atlas=t,this.bildeNavn=e,this.komponenter=i,this.initNøkkelpunktKart=s,this.nøkkelpunktKart=void 0}return{URBAN:new t(Atlas.typer.LANDSKAP,"urban4Komponent",1,function(){return[[-Number.MAX_VALUE,.85*ctx.canvas.height,1],[Number.MAX_VALUE,.85*ctx.canvas.height,1]]})}}(),Effekt.typer=function(){function t(t,e,i,s){this.atlas=t,this.bildeNavn=e,this.varighet=s,this.relativtAnkerpunkt=i}return{"GEVÆRLØPBLINK":new t(Atlas.typer.TING,"geværlopflamme",[0,.5],.08),BLOOD:new t(Atlas.typer.TING,"blodEffekt",[0,0],3)}}(),Prosjektil.typer=function(){function t(t,e,i,s,n){this.bredde=t,this.høyde=e,this.meterPerSekund=i,this.farge=n,this.skade=s}return{VANLIG:new t(config.pikselPerMeter,.02*config.pikselPerMeter,12,20,"red"),STORKULE:new t(.2*config.pikselPerMeter,.2*config.pikselPerMeter,10,10,"yellow"),PLASMA:new t(.6*config.pikselPerMeter,.02*config.pikselPerMeter,11,26,"purple"),KOMPEKANNON:new t(.4*config.pikselPerMeter,.1*config.pikselPerMeter,11,50,"yellow")}}(),Våpen.typer=function(){function t(t,e,i,s,n,r,l,a,o){this.atlas=t,this.navn=e,this.lydType=i,this.relativtAnkerpunkt=s,this.relativtGeværløp=n,this.skuddPerSekund=r/60,this.prosjektilType=l,this.effektType=a,this.effektStørrelse=o}return{ROBOTBRYSTKANON:new t(!1,!1,!1,[0,0],[0,0],40,Prosjektil.typer.STORKULE),M4A1PULSERIFLE:new t(Atlas.typer.TING,"M4A1_PulseRifle",Lyd.typer.PISTOL,[.3,.5],[.94,.25],300,Prosjektil.typer.PLASMA,Effekt.typer.GEVÆRLØPBLINK,[.4*config.pikselPerMeter,.15*config.pikselPerMeter]),M97RIFLE:new t(Atlas.typer.TING,"M97Rifle",Lyd.typer.PISTOL,[.33,.5],[.9,.21],500,Prosjektil.typer.VANLIG,Effekt.typer.GEVÆRLØPBLINK,[.4*config.pikselPerMeter,.15*config.pikselPerMeter]),DAGNYSKOMPEBLASTER:new t(Atlas.typer.TING,"fiendeDagnysKompeblaster",Lyd.typer.SKUDDMEDLADING,[0,.5],[.95,.5],80,Prosjektil.typer.KOMPEKANNON,Effekt.typer.GEVÆRLØPBLINK,[.8*config.pikselPerMeter,.3*config.pikselPerMeter])}}();